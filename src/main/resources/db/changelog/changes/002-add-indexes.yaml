databaseChangeLog:
  - changeSet:
      id: 008-add-indexes-for-performance
      author: system
      changes:
        - createIndex:
            indexName: idx_users_username
            tableName: users
            columns:
              - column:
                  name: username
        - createIndex:
            indexName: idx_users_email
            tableName: users
            columns:
              - column:
                  name: email
        - createIndex:
            indexName: idx_users_role_premium
            tableName: users
            columns:
              - column:
                  name: role
              - column:
                  name: is_premium

        # Indexes for products table
        - createIndex:
            indexName: idx_products_name
            tableName: products
            columns:
              - column:
                  name: name
        - createIndex:
            indexName: idx_products_price
            tableName: products
            columns:
              - column:
                  name: price
        - createIndex:
            indexName: idx_products_quantity
            tableName: products
            columns:
              - column:
                  name: quantity
        - createIndex:
            indexName: idx_products_deleted
            tableName: products
            columns:
              - column:
                  name: is_deleted

        - createIndex:
            indexName: idx_orders_user_id
            tableName: orders
            columns:
              - column:
                  name: user_id
        - createIndex:
            indexName: idx_orders_order_number
            tableName: orders
            columns:
              - column:
                  name: order_number
        - createIndex:
            indexName: idx_orders_status_created
            tableName: orders
            columns:
              - column:
                  name: status
              - column:
                  name: created_at

        # Indexes for order_items table
        - createIndex:
            indexName: idx_order_items_order_id
            tableName: order_items
            columns:
              - column:
                  name: order_id
        - createIndex:
            indexName: idx_order_items_product_id
            tableName: order_items
            columns:
              - column:
                  name: product_id
        - createIndex:
            indexName: idx_order_items_composite
            tableName: order_items
            columns:
              - column:
                  name: order_id
              - column:
                  name: product_id

        # Indexes for subscriptions table
        - createIndex:
            indexName: idx_subscriptions_user_id
            tableName: subscriptions
            columns:
              - column:
                  name: user_id
        - createIndex:
            indexName: idx_subscriptions_subscription_id
            tableName: subscriptions
            columns:
              - column:
                  name: subscription_id
        - createIndex:
            indexName: idx_subscriptions_status_next_payment
            tableName: subscriptions
            columns:
              - column:
                  name: status
              - column:
                  name: next_payment_date

        # Indexes for payments table
        - createIndex:
            indexName: idx_payments_subscription_id
            tableName: payments
            columns:
              - column:
                  name: subscription_id
        - createIndex:
            indexName: idx_payments_razorpay_order_id
            tableName: payments
            columns:
              - column:
                  name: razorpay_order_id
        - createIndex:
            indexName: idx_payments_razorpay_payment_id
            tableName: payments
            columns:
              - column:
                  name: razorpay_payment_id
        - createIndex:
            indexName: idx_payments_status_date
            tableName: payments
            columns:
              - column:
                  name: status
              - column:
                  name: payment_date

        # Indexes for notifications table (already defined some in entity, adding more)
        - createIndex:
            indexName: idx_notifications_type_level
            tableName: notifications
            columns:
              - column:
                  name: type
              - column:
                  name: level
        - createIndex:
            indexName: idx_notifications_created_user
            tableName: notifications
            columns:
              - column:
                  name: user_id
              - column:
                  name: created_at
  - changeSet:
      id: 009-add-foreign-key-indexes
      author: system
      changes:
        # Add composite indexes for better join performance
        - createIndex:
            indexName: idx_orders_user_status
            tableName: orders
            columns:
              - column:
                  name: user_id
              - column:
                  name: status
              - column:
                  name: created_at

        - createIndex:
            indexName: idx_products_price_quantity
            tableName: products
            columns:
              - column:
                  name: price
              - column:
                  name: quantity
              - column:
                  name: is_deleted

        - createIndex:
            indexName: idx_subscriptions_active_next_payment
            tableName: subscriptions
            columns:
              - column:
                  name: status
              - column:
                  name: next_payment_date
              - column:
                  name: user_id
            where: status = 'ACTIVE'
            
            
            
         